{"remainingRequest":"/Users/ethan/Documents/professional/research/mt-methods/mt-for-reading/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ethan/Documents/professional/research/mt-methods/mt-for-reading/node_modules/magpie-base/src/components/interactive/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ethan/Documents/professional/research/mt-methods/mt-for-reading/node_modules/magpie-base/src/components/interactive/Chat.vue","mtime":1666532369604},{"path":"/Users/ethan/Documents/professional/research/mt-methods/mt-for-reading/node_modules/cache-loader/dist/cjs.js","mtime":1666532360087},{"path":"/Users/ethan/Documents/professional/research/mt-methods/mt-for-reading/node_modules/vue-loader/lib/index.js","mtime":1666532366104}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IGRpZmZlcmVuY2UgZnJvbSAnbG9kYXNoL2RpZmZlcmVuY2UnOwpleHBvcnQgY29uc3QgRVZFTlRfQ0hBVF9NRVNTQUdFID0gJyRtYWdwaWUuY2hhdF9tZXNzYWdlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ2hhdCcsCiAgcHJvcHM6IHsKICAgIHBhcnRpY2lwYW50TGFiZWw6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiBudWxsCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbWVzc2FnZXM6IFtdLAogICAgICBpbnRlcnZhbDogbnVsbAogICAgfTsKICB9LAogIHNvY2tldDogewogICAgW0VWRU5UX0NIQVRfTUVTU0FHRV0ocGF5bG9hZCkgewogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gocGF5bG9hZCk7CiAgICAgIFZ1ZS5uZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGhpcy4kcmVmcy5ib3guc2Nyb2xsVG9wID0gdGhpcy4kcmVmcy5ib3guc2Nyb2xsSGVpZ2h0OwogICAgICB9KTsKICAgICAgLyoqCiAgICAgICAqIE1lc3NhZ2VzIGNvbnRhaW5zIGFsbCBjaGF0IG1lc3NhZ2VzIGFzIG9iamVjdHM6IGBbe21lc3NhZ2U6ICcnLCBwYXJ0aWNpcGFudElkOiAnJywgdGltZTogMjM0NTY3ODc2NX0sIC4uLl1gCiAgICAgICAqLwogICAgICB0aGlzLiRlbWl0KAogICAgICAgICd1cGRhdGU6bWVzc2FnZXMnLAogICAgICAgIHRoaXMubWVzc2FnZXMuZmlsdGVyKChtKSA9PiBtLmV2ZW50ID09PSAnbWVzc2FnZScpCiAgICAgICk7CiAgICAgIC8qKgogICAgICAgKiBEYXRhIGNvbnRhaW5zIGFsbCBjaGF0IG1lc3NhZ2VzIGluIHRhYnVsYXIgZm9ybTogYHtjaGF0TWVzc2FnZTogW10sIGNoYXRQYXJ0aWNpcGFudElkOiBbXSwgY2hhdFRpbWU6IFtdfWAKICAgICAgICovCiAgICAgIHRoaXMuJGVtaXQoCiAgICAgICAgJ3VwZGF0ZTpkYXRhJywKICAgICAgICB0aGlzLmZsYXR0ZW5EYXRhKHRoaXMubWVzc2FnZXMuZmlsdGVyKChtKSA9PiBtLmV2ZW50ID09PSAnbWVzc2FnZScpKQogICAgICApOwogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIFsnJG1hZ3BpZS5zb2NrZXQuYWN0aXZlJ10obmV3UGFydGljaXBhbnRzLCBvbGRQYXJ0aWNpcGFudHMpIHsKICAgICAgY29uc3Qgam9pbmVkID0gZGlmZmVyZW5jZShuZXdQYXJ0aWNpcGFudHMsIG9sZFBhcnRpY2lwYW50cyk7CiAgICAgIGNvbnN0IGxlZnQgPSBkaWZmZXJlbmNlKG9sZFBhcnRpY2lwYW50cywgbmV3UGFydGljaXBhbnRzKTsKICAgICAgbGVmdC5mb3JFYWNoKChwYXJ0aWNpcGFudElkKSA9PiB7CiAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKHsKICAgICAgICAgIHRpbWU6IERhdGUubm93KCksCiAgICAgICAgICBwYXJ0aWNpcGFudElkLAogICAgICAgICAgZXZlbnQ6ICdsZWF2ZScsCiAgICAgICAgICBtZXNzYWdlOiAnJwogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgam9pbmVkLmZvckVhY2goKHBhcnRpY2lwYW50SWQpID0+IHsKICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goewogICAgICAgICAgdGltZTogRGF0ZS5ub3coKSwKICAgICAgICAgIHBhcnRpY2lwYW50SWQsCiAgICAgICAgICBldmVudDogJ2pvaW4nLAogICAgICAgICAgbWVzc2FnZTogJycKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy4kbWFncGllLnNvY2tldC5hY3RpdmUuZm9yRWFjaCgocGFydGljaXBhbnRJZCkgPT4gewogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goewogICAgICAgIHRpbWU6IERhdGUubm93KCksCiAgICAgICAgcGFydGljaXBhbnRJZCwKICAgICAgICBldmVudDogJ2pvaW4nLAogICAgICAgIG1lc3NhZ2U6ICcnCiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBFVkVOVF9DSEFUX01FU1NBR0UsCiAgbWV0aG9kczogewogICAgc2VuZCgpIHsKICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuJHJlZnMudGV4dC52YWx1ZTsKICAgICAgaWYgKCFtZXNzYWdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuJG1hZ3BpZS5zb2NrZXQuYnJvYWRjYXN0KEVWRU5UX0NIQVRfTUVTU0FHRSwgewogICAgICAgIGV2ZW50OiAnbWVzc2FnZScsCiAgICAgICAgbWVzc2FnZSwKICAgICAgICBwYXJ0aWNpcGFudElkOiB0aGlzLiRtYWdwaWUuc29ja2V0LnBhcnRpY2lwYW50SWQsCiAgICAgICAgcGFydGljaXBhbnRMYWJlbDogdGhpcy5wYXJ0aWNpcGFudExhYmVsLAogICAgICAgIHRpbWU6IERhdGUubm93KCkKICAgICAgfSk7CiAgICAgIHRoaXMuJHJlZnMudGV4dC52YWx1ZSA9ICcnOwogICAgICB0aGlzLiRyZWZzLnRleHQuZm9jdXMoKTsKICAgIH0sCiAgICBmbGF0dGVuRGF0YShtZXNzYWdlcykgewogICAgICByZXR1cm4gewogICAgICAgIGNoYXRNZXNzYWdlOiBtZXNzYWdlcy5tYXAoKG0pID0+IG0ubWVzc2FnZSksCiAgICAgICAgY2hhdFBhcnRpY2lwYW50SWQ6IG1lc3NhZ2VzLm1hcCgobSkgPT4gbS5wYXJ0aWNpcGFudElkKSwKICAgICAgICBjaGF0UGFydGljaXBhbnRMYWJlbDogbWVzc2FnZXMubWFwKChtKSA9PiBtLnBhcnRpY2lwYW50SWQpLAogICAgICAgIGNoYXRUaW1lOiBtZXNzYWdlcy5tYXAoKG0pID0+IG0udGltZSkKICAgICAgfTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":";AAgFA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Chat.vue","sourceRoot":"node_modules/magpie-base/src/components/interactive","sourcesContent":["<docs>\nThis interactive component provides participants the opportunity to chat with each other, if they are in the same room.\n\n```vue\n<Experiment>\n    <Screen>\n      <button @click=\"$magpie.nextScreen()\">Start</button>\n    </Screen>\n\n    <ConnectInteractiveScreen />\n\n    <Screen>\n\n      <Slide>\n        <Chat :data.sync= \"$magpie.measurements.data\" />\n        <p>{{$magpie.measurements.data? $magpie.measurements.data.chatMessage.length : 0}} messages sent so far.</p>\n        <p>{{ $magpie.socket.active.length }} participants chatting.</p>\n      </Slide>\n\n    </Screen>\n\n</Experiment>\n```\n\n\n</docs>\n<template>\n  <div class=\"chat\">\n    <div ref=\"box\" class=\"chat-box\">\n      <p\n        v-for=\"(message, i) in messages\"\n        :key=\"i\"\n        :class=\"{\n          message: message.event === 'message',\n          userEvent: message.event === 'join' || message.event === 'leave',\n          me: message.participantId === $magpie.socket.participantId\n        }\"\n        :style=\"{\n          ...(message.message && {\n            background: $magpie.socket.getParticipantColor(\n              message.participantId\n            )\n          }),\n          ...(!message.message && {\n            color: $magpie.socket.getParticipantColor(message.participantId)\n          })\n        }\"\n        v-text=\"\n          message.message ||\n          (message.participantId === $magpie.socket.participantId\n            ? message.event === 'join'\n              ? $t('interactive.Chat.statusYouJoined')\n              : message.event === 'leave'\n              ? $t('interactive.Chat.statusYouLeft')\n              : ''\n            : message.event === 'join'\n            ? $t('interactive.Chat.statusParticipantJoined', {\n                user: $magpie.socket.getParticipantName(message.participantId)\n              })\n            : message.event === 'leave'\n            ? $t('interactive.Chat.statusParticipantLeft', {\n                user: $magpie.socket.getParticipantName(message.participantId)\n              })\n            : '')\n        \"\n      ></p>\n    </div>\n    <div class=\"chat-input\">\n      <textarea\n        ref=\"text\"\n        cols=\"50\"\n        :placeholder=\"$t('interactive.Chat.messageLabel')\"\n        @keydown.enter.prevent=\"send\"\n      ></textarea>\n      <button @click.stop=\"send()\">{{ $t('general.send') }}</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Vue from 'vue';\nimport difference from 'lodash/difference';\nexport const EVENT_CHAT_MESSAGE = '$magpie.chat_message';\n\nexport default {\n  name: 'Chat',\n  props: {\n    participantLabel: {\n      type: String,\n      default: null\n    }\n  },\n  data() {\n    return {\n      messages: [],\n      interval: null\n    };\n  },\n  socket: {\n    [EVENT_CHAT_MESSAGE](payload) {\n      this.messages.push(payload);\n      Vue.nextTick(() => {\n        this.$refs.box.scrollTop = this.$refs.box.scrollHeight;\n      });\n      /**\n       * Messages contains all chat messages as objects: `[{message: '', participantId: '', time: 2345678765}, ...]`\n       */\n      this.$emit(\n        'update:messages',\n        this.messages.filter((m) => m.event === 'message')\n      );\n      /**\n       * Data contains all chat messages in tabular form: `{chatMessage: [], chatParticipantId: [], chatTime: []}`\n       */\n      this.$emit(\n        'update:data',\n        this.flattenData(this.messages.filter((m) => m.event === 'message'))\n      );\n    }\n  },\n  watch: {\n    ['$magpie.socket.active'](newParticipants, oldParticipants) {\n      const joined = difference(newParticipants, oldParticipants);\n      const left = difference(oldParticipants, newParticipants);\n      left.forEach((participantId) => {\n        this.messages.push({\n          time: Date.now(),\n          participantId,\n          event: 'leave',\n          message: ''\n        });\n      });\n      joined.forEach((participantId) => {\n        this.messages.push({\n          time: Date.now(),\n          participantId,\n          event: 'join',\n          message: ''\n        });\n      });\n    }\n  },\n  mounted() {\n    this.$magpie.socket.active.forEach((participantId) => {\n      this.messages.push({\n        time: Date.now(),\n        participantId,\n        event: 'join',\n        message: ''\n      });\n    });\n  },\n  EVENT_CHAT_MESSAGE,\n  methods: {\n    send() {\n      const message = this.$refs.text.value;\n      if (!message) {\n        return;\n      }\n      this.$magpie.socket.broadcast(EVENT_CHAT_MESSAGE, {\n        event: 'message',\n        message,\n        participantId: this.$magpie.socket.participantId,\n        participantLabel: this.participantLabel,\n        time: Date.now()\n      });\n      this.$refs.text.value = '';\n      this.$refs.text.focus();\n    },\n    flattenData(messages) {\n      return {\n        chatMessage: messages.map((m) => m.message),\n        chatParticipantId: messages.map((m) => m.participantId),\n        chatParticipantLabel: messages.map((m) => m.participantId),\n        chatTime: messages.map((m) => m.time)\n      };\n    }\n  }\n};\n</script>\n<style>\n.chat {\n  width: 450px;\n}\n\n.chat-box {\n  overflow: auto;\n  height: 400px;\n}\n\n.userEvent {\n  width: 45%;\n  clear: both;\n  text-align: center;\n  margin: 5px auto;\n}\n\n.userEvent.me {\n  color: #70ba517a !important;\n}\n\n.message {\n  width: 55%;\n  float: left;\n  text-align: left;\n  background: #5187ba7a;\n  border-radius: 4px;\n  padding: 4px;\n  margin: 5px 0;\n}\n\n.message.me {\n  float: right;\n  background: #70ba517a !important;\n}\n\n.chat-input {\n  display: flex;\n}\n\n.chat-input textarea {\n  flex-grow: 1;\n  height: 32px;\n}\n\n.chat-input button {\n  margin: 0;\n}\n</style>\n"]}]}